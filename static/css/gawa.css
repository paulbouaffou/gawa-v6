/* =========================================================
   GAWA V6 — Style "glass" doux (moins lumineux)
   Compatible Bootstrap 5 + fond à vagues du layout
   ========================================================= */

/* ---- Palette & tokens ---- */
:root{
  /* Couleurs claires par défaut */
  --gawa-text: #1f2937;             /* gris-900 */
  --gawa-muted: rgba(0,0,0,.6);
  --gawa-card: rgba(255,255,255,.68);
  --gawa-card-border: rgba(0,0,0,.08);
  --gawa-chip-bg: rgba(255,255,255,.8);
  --gawa-chip-text: #111827;

  /* Transitions douces */
  --gawa-ease: 200ms ease;
}

html, body{
  color: var(--gawa-text);
  transition: color var(--gawa-ease), background-color var(--gawa-ease);
}

/* Cartes / puces utilisent les variables */
.gawa-card{
  background: var(--gawa-card);
  border: 1px solid var(--gawa-card-border);
}
.gawa-chip{
  background: var(--gawa-chip-bg);
  color: var(--gawa-chip-text);
}

/* ----- Mode sombre ----- */
[data-theme="dark"]{
  --gawa-text: #e5e7eb;             /* gris-200 */
  --gawa-muted: rgba(229,231,235,.7);
  --gawa-card: rgba(17,24,39,.66);   /* ardoise-900 */
  --gawa-card-border: rgba(255,255,255,.08);
  --gawa-chip-bg: rgba(17,24,39,.85);
  --gawa-chip-text: #e5e7eb;
}

/* Fond : variante sombre (si tu utilises un dégradé de fond global) */
[data-theme="dark"] body{
  background: radial-gradient(1200px 600px at 10% -10%, #0f172a 0%, #0b1b3a 45%, #3b0764 100%) fixed;
}

/* Bouton toggle lisible dans les deux thèmes */
#theme-toggle{
  border-color: var(--gawa-card-border) !important;
  color: var(--gawa-text) !important;
}

:root{
  --gawa-surface: rgba(255,255,255,.72); /* surface translucide */
  --gawa-surface-strong: rgba(255,255,255,.86);
  --gawa-border: rgba(255,255,255,.35);
  --gawa-text: #212529;
  --gawa-muted: #6c757d;
  --gawa-primary: #0d6efd;
  --gawa-accent: #23b38a;
  --gawa-radius: 16px;
  --gawa-shadow: 0 18px 40px rgba(0,0,0,.15);
}

/* Texte global lisible sur fond en dégradé */
body { color: var(--gawa-text); }

/* ---- Cartes / panneaux (glassmorphism) ---- */
.gawa-card{
  background: var(--gawa-surface);
  border-radius: var(--gawa-radius);
  border: 1px solid var(--gawa-border);
  box-shadow: var(--gawa-shadow);
  padding: 16px;
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}

/* Option “surface plus opaque” si besoin ponctuel */
.gawa-card.solid {
  background: var(--gawa-surface-strong);
}

/* Titres de sections */
.gawa-panel-title{
  font-weight: 600;
  font-size: 1.06rem;
  color: var(--gawa-text);
  margin-bottom: .25rem;
}

/* ---- KPI ---- */
.gawa-kpi .kpi-label{
  color: var(--gawa-muted);
  font-size: .92rem;
  margin-bottom: 6px;
}
.gawa-kpi .kpi-value{
  font-weight: 700;
  font-size: 1.8rem;
  line-height: 1.1;
}

/* ---- Chips d’infos (Qualité) ---- */
.gawa-chip{
  display: inline-block;
  background: rgba(255,255,255,.55);
  border: 1px solid var(--gawa-border);
  color: var(--gawa-text);
  border-radius: 999px;
  padding: 6px 12px;
  font-size: .95rem;
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
  box-shadow: 0 8px 20px rgba(0,0,0,.08);
  white-space: nowrap;
}

/* ---- Formulaires (filtres) ---- */
.form-label{ color: var(--gawa-muted); font-weight: 500; }
.form-control,
.form-select{
  border-radius: 12px;
  border: 1px solid rgba(0,0,0,.08);
  background: var(--gawa-surface-strong);
  color: var(--gawa-text);
  box-shadow: none !important;
  backdrop-filter: blur(6px);
  -webkit-backdrop-filter: blur(6px);
}
.form-control::placeholder{ color: #8a8f98; }
.form-control:focus,
.form-select:focus{
  border-color: var(--gawa-primary);
  box-shadow: 0 0 0 .2rem rgba(13,110,253,.14) !important;
  outline: 0;
}

/* ---- Boutons ---- */
.btn-primary{
  border-radius: 12px;
  box-shadow: 0 10px 26px rgba(13,110,253,.28);
  border: 1px solid rgba(13,110,253,.25);
}
.btn-primary:active{ transform: translateY(1px); }

/* ---- Graphiques (Chart.js) ---- */
canvas{ max-width: 100% !important; }

/* Si tu enveloppes tes canvases dans un conteneur, tu peux lui mettre .gawa-card
   pour profiter du même rendu glass. */

/* ---- Alerte globale ---- */
#error{
  border-radius: 12px;
  border: 1px solid rgba(255,0,0,.25);
}

/* ---- Spacing / responsive ---- */
@media (max-width: 575.98px){
  .gawa-card{ padding: 14px; }
  .gawa-kpi .kpi-value{ font-size: 1.55rem; }
}

/* ---- Accessibilité / performances ---- */
@media (prefers-reduced-motion: reduce){
  .gawa-card,
  .gawa-chip { animation: none; }
}

/* Si certaines machines sont lentes avec le blur, tu peux réduire l’intensité :
   .gawa-card { backdrop-filter: blur(6px); } */

/* Titres plus “display” et contraste léger */
h1, h2, h3, h4 { letter-spacing: .2px; }
.text-muted { color: rgba(33,37,41,.75) !important; }
/* 1) Hover doux sur cartes KPI */
.gawa-kpi .gawa-card{
  transition: transform .18s ease, box-shadow .18s ease;
}
.gawa-kpi .gawa-card:hover{
  transform: translateY(-2px);
  box-shadow: 0 16px 36px rgba(0,0,0,.18);
}

/* 2) Conteneurs responsives pour charts */
.chart-wrap{
  position: relative;
  width: 100%;
  /* On contrôle la hauteur via aspect-ratio pour éviter les canvas trop bas/hauts */
  aspect-ratio: 16 / 9;         /* desktop */
  min-height: 240px;            /* garde de la lisibilité */
}
@media (max-width: 991.98px){   /* tablette */
  .chart-wrap{ aspect-ratio: 4 / 3; min-height: 220px; }
}
@media (max-width: 575.98px){   /* mobile */
  .chart-wrap{ aspect-ratio: 1 / 1; min-height: 200px; }
}

/* 3) Animations d’entrée (fade + slide up) */
.reveal{
  opacity: 0;
  transform: translateY(14px);
  transition: opacity .5s ease, transform .5s ease;
  will-change: opacity, transform;
}
.reveal.in{
  opacity: 1;
  transform: translateY(0);
}

/* Respecte la préférence utilisateur */
@media (prefers-reduced-motion: reduce){
  .gawa-kpi .gawa-card,
  .reveal{
    transition: none !important;
    transform: none !important;
  }
}
/* Conteneurs responsives pour charts */
.chart-wrap{
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 9;   /* desktop */
  min-height: 240px;      /* garde de la lisibilité si aspect-ratio n’est pas supporté */
}
@media (max-width: 991.98px){   /* tablette */
  .chart-wrap{ aspect-ratio: 4 / 3; min-height: 220px; }
}
@media (max-width: 575.98px){   /* mobile */
  .chart-wrap{ aspect-ratio: 1 / 1; min-height: 200px; }
}

/* Chart.js : le canvas suit le parent */
.chart-wrap > canvas{
  position: absolute;
  inset: 0;
  width: 100% !important;
  height: 100% !important;
}
/* =========================================================
   Mode sombre — activé quand <html data-theme="dark">
   (On ne casse rien : on surchage seulement les variables)
   ========================================================= */

:root[data-theme="dark"]{
  --gawa-surface: rgba(20,24,28,.72);
  --gawa-surface-strong: rgba(20,24,28,.86);
  --gawa-border: rgba(255,255,255,.10);
  --gawa-text: #e9ecef;
  --gawa-muted: #adb5bd;
  --gawa-primary: #66b2ff;  /* bleu un peu plus clair pour fond sombre */
  --gawa-accent: #2fd6a2;
  --gawa-shadow: 0 18px 40px rgba(0,0,0,.35);
}

/* Cartes/chips héritent déjà des variables — pas besoin de dupliquer,
   on ajuste juste quelques détails pour le dark */

:root[data-theme="dark"] .gawa-chip{
  background: rgba(255,255,255,.08);
  border-color: rgba(255,255,255,.12);
  color: var(--gawa-text);
}

:root[data-theme="dark"] .form-control,
:root[data-theme="dark"] .form-select{
  background: rgba(255,255,255,.06);
  color: var(--gawa-text);
  border-color: rgba(255,255,255,.12);
}

:root[data-theme="dark"] .btn-primary{
  box-shadow: 0 10px 26px rgba(102,178,255,.22);
  border-color: rgba(102,178,255,.35);
}

/* Alerte globale lisible en dark */
:root[data-theme="dark"] #error{
  background: rgba(220,53,69,.15);
  color: #ffd1d6;
  border-color: rgba(220,53,69,.35);
}

/* Optionnel: assombrir légèrement les vagues si tu utilises le fond animé */
:root[data-theme="dark"] .wave{
  opacity: 0.5;
  filter: brightness(.85);
}

/* --- Corriger l’avertissement will-change --- */

/* On annule will-change si on l’a mis trop largement */
.reveal,
.gawa-card,
.metric-card,
.chart-wrap canvas,
.wave {
  will-change: auto !important;
}

/* Containment pour limiter la surface de repaint des charts */
.chart-wrap {
  contain: paint;
}

/* Si l’utilisateur préfère moins d’animations, on coupe les vagues */
@media (prefers-reduced-motion: reduce) {
  .wave { animation: none !important; }
}

/* ===== Animations d'entrée (reveal) ===== */
.reveal {
  opacity: 0;
  transform: translateY(10px);
  transition: opacity .45s ease, transform .45s ease;
}
.reveal.in {
  opacity: 1;
  transform: translateY(0);
}

/* Effet hover léger sur les cartes KPI */
.kpi-card {
  transition: transform .18s ease, box-shadow .18s ease;
}
.kpi-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 22px rgba(0,0,0,.08);
}

/* Respecte 'prefers-reduced-motion' */
@media (prefers-reduced-motion: reduce) {
  .reveal {
    transition: none;
    transform: none !important;
    opacity: 1 !important;
  }
  .kpi-card { transition: none; }
  .kpi-card:hover { transform: none; box-shadow: none; }
}

/* --- Charts height --- */
.chart-wrap { position: relative; height: 280px; }

/* --- Entrée en douceur des sections --- */
.reveal { opacity: 0; transform: translateY(8px); transition: opacity .45s ease, transform .45s ease; }
.reveal.in { opacity: 1; transform: none; }

/* --- KPI: hover léger + échelonnage --- */
.gawa-kpi .kpi-card {
  transition: transform .15s ease, box-shadow .2s ease, opacity .35s ease;
  will-change: transform;
}
.gawa-kpi .kpi-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 10px 24px rgba(0,0,0,.08);
}

/* Petits délais pour un effet “cascade” sur les 4 KPI */
.gawa-kpi .col-md-3:nth-child(1) .kpi-card { transition-delay: .00s; }
.gawa-kpi .col-md-3:nth-child(2) .kpi-card { transition-delay: .06s; }
.gawa-kpi .col-md-3:nth-child(3) .kpi-card { transition-delay: .12s; }
.gawa-kpi .col-md-3:nth-child(4) .kpi-card { transition-delay: .18s; }

/* Empêche les <select> de se comprimer en pastille étroite */
.gawa-card .form-select,
.gawa-card .form-control { min-width: 0; width: 100%; }
.gawa-card .form-select { white-space: nowrap; text-overflow: ellipsis; overflow: hidden; }

/* Optionnel: largeur mini confortable pour les filtres sur très petits écrans */
#f-project, #f-banner { min-width: 180px; }
/* —— Contributeur: harmonisation légère —— */
[data-theme="dark"] .group input,
[data-theme="dark"] .group textarea {
  border-bottom-color: rgba(255,255,255,.25);
}
[data-theme="dark"] .group label {
  color: rgba(255,255,255,.7);
}
/* === Formulaires : mode sombre lisible === */
:root[data-theme="dark"] { color-scheme: dark; }

/* Textes des champs */
[data-theme="dark"] .group input[type="text"],
[data-theme="dark"] .group input[type="email"],
[data-theme="dark"] .group input[type="search"],
[data-theme="dark"] .group textarea,
[data-theme="dark"] input[type="date"],
[data-theme="dark"] .form-select {
  color: #f8f9fa !important;
  caret-color: #f8f9fa;
  background-color: transparent; /* garder le style “ligne” */
  border-color: rgba(255,255,255,.25);
}

/* Libellés flottants et placeholders */
[data-theme="dark"] .group label { color: rgba(255,255,255,.75); }
[data-theme="dark"] ::placeholder { color: rgba(255,255,255,.55); opacity: 1; }

/* Barre animée sous les champs (focus) */
[data-theme="dark"] .bar:before,
[data-theme="dark"] .bar:after {
  background: var(--bs-primary, #0d6efd);
}

/* Focus visibles (sans halo bleu agressif) */
[data-theme="dark"] .group input:focus,
[data-theme="dark"] .group textarea:focus,
[data-theme="dark"] .form-select:focus,
[data-theme="dark"] input[type="date"]:focus {
  outline: none;
  box-shadow: none;
  border-color: rgba(13,110,253,.6);
}

/* Sélecteur (projets, disponibilité) fond/texte corrects */
[data-theme="dark"] .form-select {
  background-color: rgba(255,255,255,.06);
  color: #f8f9fa;
  border-color: rgba(255,255,255,.25);
}

/* Chrome/Edge/Safari : corriger l’autofill (qui met du texte clair sur fond clair) */
[data-theme="dark"] input:-webkit-autofill,
[data-theme="dark"] textarea:-webkit-autofill,
[data-theme="dark"] select:-webkit-autofill {
  -webkit-text-fill-color: #f8f9fa !important;
  -webkit-box-shadow: 0 0 0px 1000px rgba(255,255,255,.08) inset;
  transition: background-color 5000s ease-in-out 0s;
}

/* Firefox autofill */
[data-theme="dark"] input:-moz-autofill,
[data-theme="dark"] textarea:-moz-autofill,
[data-theme="dark"] select:-moz-autofill {
  box-shadow: 0 0 0px 1000px rgba(255,255,255,.08) inset;
  -moz-text-fill-color: #f8f9fa;
}